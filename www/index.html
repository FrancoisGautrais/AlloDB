<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <link rel="stylesheet" type="text/css" href="/css/materialize.css">
  <link rel="stylesheet" type="text/css" href="/gen/colors.css">
  <link rel="stylesheet" type="text/css" href="/css/icons.css">
  <link rel="stylesheet" type="text/css" href="/css/common.css">
  <title>Rechercher</title>

</head>

<body>
    <#include("www/gen/header.html")>

    <main>
        <div class="container row">
            <div class="row col  s12 offset-m4 m4">
                <center><h1>Recherche</h1></center>

                <form id="root-widget" action="/results" method="post">
                    <!--<div class="input-field col offset-s2 s8 offset-m4 m4 ">
                        <input id="it-match" type="text" name="match" class="validate">
                        <label for="it-match">Texte à recrecher</label>
                    </div>-->
                    <#row(input_text("widget-it-match", "Texte à recrecher", "text", "Filtrer le titre", 0, "match"))>

                    <#row(
                        list(col(multiple_select("widget-sm-genre",
                            "Filtrer par genre", objl("comédie" , "comédie",    "divers" , "divers",    "drame" , "drame",    "documentaire" , "documentaire",    "romance" , "romance",    "comédie dramatique" , "comédie dramatique",    "epouvante-horreur" , "epouvante-horreur",    "thriller" , "thriller",    "animation" , "animation",    "espionnage" , "espionnage",    "action" , "action",    "famille" , "famille",    "policier" , "policier",    "guerre" , "guerre",    "erotique" , "erotique",    "historique" , "historique",    "western" , "western",    "aventure" , "aventure",    "fantastique" , "fantastique",    "musical" , "musical",    "bollywood" , "bollywood",    "arts martiaux" , "arts martiaux",    "comédie musicale" , "comédie musicale",    "expérimental" , "expérimental",    "science fiction" , "science fiction",    "biopic" , "biopic",    "sport event" , "sport event",    "péplum" , "péplum",    "judiciaire" , "judiciaire",    "show" , "show",    "opera" , "opera",    "concert" , "concert",    "survival, science-fiction, aventure" , "survival",    "classique" , "classique"
                        ), "genre"), "col s8"),
                        col(select("widget-s-genre-op", "Et / Ou", objl("or", "Ou", "and", "Et"), "genre-op"), "col s4")))>

                    <#row(
                        list(col(multiple_select("widget-sm-pays",
                            "Filtrer par pays", objl(
                            "afghan" , "af","albanais" , "al","algérien" , "dz","allemand" , "de","américain" , "us","andorran" , "ad","angolais" , "ao","antiguais" , "ag","argentin" , "ar","arménien" , "am","australien" , "au","autrichien" , "at","azerbaïdjanais" , "az","bahaméen" , "bs","bahreini" , "bh","barbadien" , "bb","belge" , "be","belizien" , "bz","bengali" , "","Bermudien" , "bm","bhoutanais" , "bt","birman" , "","bissau-guinéen" , "","biélorusse" , "","bolivien" , "bo","bosniaque" , "ba","botswanais" , "bw","britannique" , "uk","brésilien" , "br","bulgare" , "bg","burkinabé" , "bf","burundais" , "bi","béninois" , "bj","cambodgien" , "kh","camerounais" , "cm","canadien" , "ca","cap-verdiens" , "","centrafricain" , "cf","chilien" , "cl","chinois" , "cn","chypriote" , "cy","colombien" , "co","congolais" , "cg","coréen" , "kr","Costaricain" , "cr","croate" , "hr","cubain" , "cu","danois" , "dk","djiboutiens" , "dj","dominicain" , "dm","espagnol" , "es","est-allemand" , "de","estonien" , "ee","finlandais" , "fi","français" , "fr","gabonais" , "ga","ghanéen" , "gh","grec" , "gr","guatémaltèque" , "gt","guinéen" , "gn","géorgien" , "ge","haïtien" , "ht","hondurien" , "hn","hong-kongais" , "hk","hongrois" , "hu","indien" , "in","indonésien" , "id","Indéfini" , "","Irakien" , "iq","iranien" , "ir","irlandais" , "ie","islandais" , "is","israélien" , "il","italien" , "it","ivoirien" , "ci","jamaïcain" , "jm","japonais" , "jp","jordanien" , "jo","kazakh" , "kz","Kenyan" , "ke","kirghiz" , "kg","kowetien" , "kw","laotien" , "la","letton" , "lv","libanais" , "lb","libyen" , "ly","libérien" , "lr","liechtensteinois" , "li","lituanien" , "lt","luxembourgeois" , "lu","macédonien" , "mk","malaisien" , "my","malawites" , "mw","malgache" , "mg","malien" , "ml","maltais" , "mt","marocain" , "ma","mauriciens" , "mu","mauritanien" , "mr","mexicain" , "mx","moldave" , "md","Monegasque" , "mc","mongol" , "mn","monténégrin" , "me","mozambiquais" , "mz","namibien" , "na","ni-vanuatu" , "","nicaraguéen" , "ni","nigérian" , "ne","nigérien" , "ng","nord-coréen" , "kp","norvégien" , "no","néerlandais" , "nl","néo-zélandais" , "nz","népalais" , "np","ouest-allemand" , "de","ougandais" , "ug","ouzbek" , "uz","pakistanais" , "pk","palestinien" , "ps","panaméen" , "pa","papouan-néo guinéen" , "pg","paraguayen" , "py","philippin" , "ph","polonais" , "pl","portoricain" , "pr","portugais" , "pt","péruvien" , "pe","qatarien" , "qa","Québecois" , "ca","roumain" , "ro","russe" , "ru","rwandais" , "rw","samoan" , "us","saoudien" , "sa","serbe" , "rs","sierra-léonais" , "sl","singapourien" , "sg","slovaque" , "sk","slovène" , "si","somalien" , "so","soudanais" , "sd","soviétique" , "su","sri-lankais" , "lk","sud-africain" , "za","sud-coréen" , "kr","suisse" , "ch","surinamien" , "sr","suédois" , "se","swazi" , "sz","syrien" , "sy","sénégalais" , "sn","tadjik" , "tj","tanzanien" , "tz","taïwanais" , "tw","tchadien" , "td","tchèque" , "cz","tchécoslovaque" , "cz","thaïlandais" , "th","togolais" , "tg","tongien" , "to","trinidadiens" , "tt","tunisien" , "tn","turc" , "tr","turkmène" , "tm","tuvaluan" , "","U.S.A." , "us","ukrainien" , "ua","uruguayen" , "uy","vietnamien" , "vn","vénézuélien" , "ve","yougoslave" , "yu","yéménite" , "ye","zambien" , "zm","zaïrois" , "","zimbabwéen" , "","égyptien" , "eg","émirati" , "","équato-guinéen" , "","équatorien" , "ec","éthiopien" , "et"
                        ), "pays"), "col s8"),
                        col(select("widget-s-pays-op", "Et / Ou", objl("or", "Ou", "and", "Et"), "pays-op"), "col s4")))>
                    <#row(list(
                        col(input_text("widget-itf-note-min", "", "number", "Note min", 0, "note-min"), "col s6"),
                        col(input_text("widget-itf-note-max", "", "number", "Note max", 0, "note-max"), "col s6")
                    ))>
                    <#row(list(
                        col(input_text("widget-itn-duration-min", "", "number", "Durée (minute) min", 0, "duration-min"), "col s6"),
                        col(input_text("widget-itn-duration-max", "", "number", "Durée (minute) max", 0, "duration-max"), "col s6")
                    ))>
                    <#row(input_text("widget-it-actor", "Filtrer par acteur", "text", "Filtrer par acteur", 0, "actor"))>
                    <#row(input_text("widget-it-director", "Filtrer par réalisateur", "text", "Filtrer par réalisateur", 0, "director"))>
                    <#row(list(
                        col(input_text("widget-itn-year-min", "", "number", "Année min", 0, "year-min"), "col s6"),
                        col(input_text("widget-itn-year-max", "", "number", "Année max", 0, "year-max"), "col s6")
                    ))>
                    <#row(list(
                        col(input_text("widget-itn-nnote-min", "", "number", "# de note min", 0, "nnote-min"), "col s6"),
                        col(input_text("widget-itn-nnote-max", "", "number", "# de note max", 0, "nnote-max"), "col s6")
                    ))>
                    <#row(list(
                        col(input_text("widget-itn-nreview-min", "", "number", "# de critiques min", 0, "nreview-min"), "col s6"),
                        col(input_text("widget-itn-nreview-max", "", "number", "# de critiques max", 0, "nreview-max"), "col s6")
                    ))>
                    <#row(list(
                            col(select("widget-sb-tosee", "Marqué à voir", objl("", "", "True", "Oui", "False", "Non"), "tosee"), "col s6"),
                            col(select("widget-sb-seen", "Marqué déja vu", objl("", "", "True", "Oui", "False", "Non"), "seen"), "col s6")
                    )))>
                    <#row(list(
                            col(select("widget-s-order", "Trié par", objl(
                                "", "",
                                "note", "Note",
                                "year", "Année",
                                "nationality", "Pays",
                                "genre", "Genre",
                                "director", "Réalisateur",
                                "nnote", "# note",
                                "nreview", "# critique",
                                "tosee", "Marqué à voir",
                                "seen", "Marqué vu"
                                ), "order"
                            ), "col s8"),
                            col(select("widget-s-order-sort", "Marqué déja vu", objl("asc", "Croissant", "desc", "Décroissant"), "order-sort"), "col s4")
                    )))>
                    <#row(input_text("widget-itn-rand", "", "number", "Tirer des résultats au hazard", 0, "rand"))>
                    <#row(select("widget-s-nperpage", "Résultats par page", objl("10", "10", "50", "50", "100", "100"))))>



                    <div class="col offset-s4 s4 offset-m4 m4 row">
                        <a onclick="send_request()" class="btn fond-color-2 color-4">Envoyer</a>
                        <!--<input type="submit" class="btn fond-color-2 color-4" />-->
                    </div>
                </form>
            </div>
        </div>
    </main>
    <script>
        var postjson={}

        function it_val(x){ return (x.length==0)?null:x  }
        function itn_val(x){ return (x.length==0)?null:parseInt(x)  }
        function itf_val(x){ return (x.length==0)?null:parseFloat(x)  }

        function s_val(x){ return (x.length==0)?null:x  }
        function sm_val(x){ return (x.length==0)?null:x  }
        function sb_val(x){ return (x.length==0)?null:(x=="True")  }


        function add_widget_val(x){
            var id=x.attr("id").substring(7)
            var type=id.substr(0,id.search("-"))
            var name=id.substr(id.search("-")+1)
            var val=null
            var tmp=null
            switch(type){
                case "it": val=it_val(x.val()); break;
                case "itn": val=itn_val(x.val()); break;
                case "itf": val=itf_val(x.val()); break;
                case "s": val=s_val(x.val()); break;
                case "sm": val=sm_val(x.val()); break;
                case "sb": val=sb_val(x.val()); break;
                default: alert(type+" inconnu")
            }
            postjson[name]=val
        }

        function send_request(){
        alert("ok")
            $("#root-widget").find('[id^=widget-]').each(function(a,b){ add_widget_val($(b)) } )
            alert(JSON.stringify(postjson, null, 2))
            $('body').append($('<form/>')
              .attr({'action': "results", 'method': 'post', 'id': 'replacer'})
              .append($('<input/>')
                .attr({'type': 'hidden', 'name': 'request', 'value': JSON.stringify(postjson)})
              )
            ).find('#replacer').submit();
        }
    </script>
    <#include("www/gen/footer.html")>
    <script type="text/javascript" src="/js/jquery.min.js"></script>
    <script type="text/javascript" src="/js/materialize.min.js"></script>
    <script type="text/javascript" src="/js/init.js"></script>
</body>

</html>